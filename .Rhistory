# 버전 특성을 타요!
# package들은 dependency(의존성)에 신경써야 해요
# 현재 R 버전을 확인해보아요!
sessionInfo() #R version 3.6.1 (2019-07-05)
# map 만들때 필요한 packages
install.packages("ggmap")
install.packages("readxl")
install.packages("xlsx")
install.packages("dplyr")
install.packages("dplyr")
install.packages("stringr")
# map 만들때 필요한 packages
install.packages("ggmap")
install.packages("readxl")
install.packages("xlsx")
install.packages("dplyr")
install.packages("stringr")
# map 만들때 필요한 packages
install.packages("ggmap")
install.packages("raster")
install.packages("rgeos")
install.packages("maptools")
install.packages("rgdal")
install.packages("viridis")
install.packages("ggplot2")
install.packages("devtools")
install.packages("plotly")
install.packages("dygraphs")
library(readxl)
library(xlsx)
library(dplyr)
library(stringr)
library(ggmap)
library(raster)
library(rgeos)
library(maptools)
library(rgdal)
library(viridis)
libraray(ggplot2)
library(ggplot2)
library(devtools)
library(plotly)
library(dygraphs)
# 구별 인구 수 -> pop
population_file = "C:/Users/LHJ/Desktop/안심귀가 project/구별 인구 수.xls"
raw_population <- read_excel(path = population_file)
pop <- as.data.frame(raw_population)
pop <- rename(pop,gu=...1)
# 구별 연도별 범죄 발생 건 수 ->crime
crime_file = "C:/Users/LHJ/Desktop/안심귀가 project/구별 연도별 범죄 발생 건수.xls"
raw_crime <- read_excel(path = crime_file)
View(pop);str(pop)
# 구별 연도별 범죄 발생 건 수 ->crime
crime_file = "C:/Users/LHJ/Desktop/안심귀가 project/구별 연도별 범죄 발생 건수.xls"
raw_crime <- read_excel(path = crime_file)
crime <- as.data.frame(raw_crime)
crime <- rename(crime,
gu=...1,
c_14=`2014`,
c_15=`2015`,
c_16=`2016`,
c_17=`2017`,
c_18=`2018`)
# 구별 경찰서 개소 수 -> police
police_file = "C:/Users/LHJ/Desktop/안심귀가 project/서울시 구별 경찰관서 개소 수.xls"
raw_police <- read_excel(path = police_file)
police <- as.data.frame(raw_police)
police <- rename(police,
gu=...1,
p_station=경찰서,
p_substation=지구대파출소치안센터)
# 구별 연도별 cctv 개수 -> cctv
cctv_file = "C:/Users/LHJ/Desktop/안심귀가 project/서울시 자치구 년도별 CCTV 설치 현황(2011년 이전_2018년).xlsx"
raw_cctv <- read_excel(path = cctv_file)
cctv <- as.data.frame(raw_cctv)
cctv <- rename(cctv,
gu=...1,
cam_14=`2014`,
cam_15=`2015`,
cam_16=`2016`,
cam_17=`2017`,
cam_18=`2018`)%>%
select("gu","cam_14","cam_15","cam_16","cam_17","cam_18")
#######################1. 10만명 당 범죄 건수가 많은 구(pop,crime 사용)->gu_crime
gu_crime <- left_join(pop,crime)%>%
select("gu","population","c_18")%>%
mutate(gu_crime=c_18/(population/100000))%>%
arrange(desc(gu_crime))
str(gu_crime);View(gu_crime)
#######################2. CCTV로도 범죄가 줄어들지 않는 구(crime,cctv사용)->cctv_cor
# 구 이름 통일해주기
for (i in 1:length(cctv$gu)){
cctv$gu[i]<-str_replace_all(cctv$gu[i]," ","")
}
# 구 이름 순서대로 맞춰주기
cctv<-cctv%>%arrange(gu)
crime<-crime%>%arrange(gu)
View(cctv);View(crime)
# cor를 하기 위해 data 형식 바꿔주기
cctv_f<-as.data.frame(t(cctv),stringsAsFactors = F)
crime_f<-as.data.frame(t(crime),stringsAsFactors = F)
gu = cctv$gu
cor_v = c()
for (i in 1:length(gu)){
cor_v[i] <- cor(as.numeric(cctv_f[2:6,i]),as.numeric(crime_f[2:6,i]))
}
cor_v
cctv_cor<-as.data.frame(cbind(gu,cor_v))
cctv_cor<- cctv_cor%>%
arrange(cor_v)
#######################3. 10만명 당 지구대, 경찰서 수가 적은 구(pop,police 사용)->gu_police
gu_police <- left_join(pop,police)%>%
mutate(gu_police=(p_station+p_substation)/(population/100000))%>%
arrange(gu_police)
View(gu_police)
####################### 어떤 지역 선택??
head(gu_crime)
gu_police
head(cctv_cor)
###########################################gu_crime 시각화
map <- shapefile("C:/Users/student/Desktop/semi_data/SIG_201703/TL_SCCO_SIG.shp")
###########################################gu_crime 시각화
map <- shapefile("C:/Users/LHJ/Desktop/안심귀가 project/SIG_201703/TL_SCCO_SIG.shp")
map <- spTransform(map,CRSobj = CRS("+proj=longlat"))
korea_map <- fortify(map,region = "SIG_CD")
raw <- "C:/Users/LHJ/Desktop/안심귀가 project/gu_mapid.csv"
mapid <- "C:/Users/LHJ/Desktop/안심귀가 project/gu_mapid.csv"
mapid_df <- read.csv(file = mapid,
header = T)
View(mapid_df)
Vies(gu_crime)
View(gu_crime)
View(mapid_df)
mapid_df <- rename(mapid_df,
gu=시군구명)
View(mapid_df)
gu_crime_df <- select(gu_crime,"gu","gu_crime")
left_join(mapid_df,gu_crime_df)
korea_map$id <- as.numeric(korea_map$id)
seoul_map <- korea_map[korea_map$id <= 11740,]
map_merge <- merge(seoul_map, df, by="id")
mapid <- "C:/Users/LHJ/Desktop/안심귀가 project/gu_mapid.csv"
mapid_df <- read.csv(file = mapid,
header = T)
gu_crime_df <- select(gu_crime,"gu","gu_crime")%>%
rename(시군구명=gu)
df <-left_join(mapid_df,gu_crime_df)
str(df)
str(mapid_df)
raw <- "E:/4차산업멀티캠퍼스/semi_data/female_pop.csv"
df <- read.csv(file = raw,
header = T)
df
map <- shapefile("C:/Users/student/Desktop/semi_data/SIG_201703/TL_SCCO_SIG.shp")
map <- shapefile("E:/4차산업멀티캠퍼스/semi_data/SIG_201703/TL_SCCO_SIG.shp")
map <- spTransform(map,CRSobj = CRS("+proj=longlat"))
korea_map <- fortify(map,region = "SIG_CD")
str(df)
str(df)
map <- shapefile("E:/4차산업멀티캠퍼스/semi_data/SIG_201703/TL_SCCO_SIG.shp")
map <- spTransform(map,CRSobj = CRS("+proj=longlat"))
korea_map <- fortify(map,region = "SIG_CD")
class(korea_map)
View(korea_map)
korea_map$id <- as.numeric(korea_map$id)
seoul_map <- korea_map[korea_map$id <= 11740,]
korea_map$id <- as.numeric(korea_map$id)
seoul_map <- korea_map[korea_map$id <= 11740,]
map_merge <- merge(seoul_map, df, by="id")
View(map_merge)
mapmap <- ggplot() + geom_polygon(data = map_merge,
aes(x=long, y = lat, group = group,fill=fpop),
color = "black")
mapmap
whymap<-mapmap+ scale_fill_gradient(low='white', high='#004ea2')
whymap
# 색상 바꿔주기
whymap <- mapmap + scale_fill_gradient(low = "#ffe5e5",
high = "#ff3232",
space = "Lab",
guide = "colourbar")+ theme_bw()
whymap
