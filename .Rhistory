library(devtools)
library(plotly)
library(dygraphs)
install.packages("dygraphs")
library(dygraphs)
# 구별 인구 수 -> pop
#population_file = "C:/Users/LHJ/Desktop/안심귀가 project/구별 인구 수.xls"
population_file = "C:/Users/student/Desktop/local_reposit/semi_project/data/구별 인구 수.xls"
raw_population <- read_excel(path = population_file)
pop <- as.data.frame(raw_population)
pop <- rename(pop,gu=...1)
View(pop);str(pop)
# 구별 연도별 범죄 발생 건 수 ->crime
#crime_file = "C:/Users/LHJ/Desktop/안심귀가 project/구별 연도별 범죄 발생 건수.xls"
crime_file = "C:/Users/student/Desktop/local_reposit/semi_project/data/구별 연도별 범죄 발생 건수.xls"
raw_crime <- read_excel(path = crime_file)
crime <- as.data.frame(raw_crime)
crime <- rename(crime,
gu=...1,
c_14=`2014`,
c_15=`2015`,
c_16=`2016`,
c_17=`2017`,
c_18=`2018`)
View(crime);str(crime)
# 구별 경찰서 개소 수 -> police
police_file = "C:/Users/LHJ/Desktop/안심귀가 project/서울시 구별 경찰관서 개소 수.xls"
raw_police <- read_excel(path = police_file)
# 구별 경찰서 개소 수 -> police
#police_file = "C:/Users/LHJ/Desktop/안심귀가 project/서울시 구별 경찰관서 개소 수.xls"
police_file = "C:/Users/student/Desktop/local_reposit/semi_project/data/서울시 구별 경찰관서 개소 수.xls"
raw_police <- read_excel(path = police_file)
police <- as.data.frame(raw_police)
police <- rename(police,
gu=...1,
p_station=경찰서,
p_substation=지구대파출소치안센터)
View(police);str(police)
# 구별 연도별 cctv 개수 -> cctv
#cctv_file = "C:/Users/LHJ/Desktop/안심귀가 project/서울시 자치구 년도별 CCTV 설치 현황(2011년 이전_2018년).xlsx"
cctv_file ="C:/Users/student/Desktop/local_reposit/semi_project/data/서울시 자치구 년도별 CCTV 설치 현황(2011년 이전_2018년).xlsx"
raw_cctv <- read_excel(path = cctv_file)
cctv <- as.data.frame(raw_cctv)
cctv <- rename(cctv,
gu=...1,
cam_14=`2014`,
cam_15=`2015`,
cam_16=`2016`,
cam_17=`2017`,
cam_18=`2018`)%>%
select("gu","cam_14","cam_15","cam_16","cam_17","cam_18")
View(cctv);str(cctv)
#######################1. 10만명 당 범죄 건수가 많은 구(pop,crime 사용)->gu_crime
gu_crime <- left_join(pop,crime)%>%
select("gu","population","c_18")%>%
mutate(gu_crime=c_18/(population/100000))%>%
arrange(desc(gu_crime))
source('C:/Users/student/Desktop/local_reposit/semi_project/semi_project.R', encoding = 'UTF-8', echo=TRUE)
install.packages("stringr")
install.packages("ggmap")
#######################1. 10만명 당 범죄 건수가 많은 구(pop,crime 사용)->gu_crime
gu_crime <- left_join(pop,crime)%>%
select("gu","population","c_18")%>%
mutate(gu_crime=c_18/(population/100000))%>%
arrange(desc(gu_crime))
str(gu_crime);View(gu_crime)
#######################2. CCTV로도 범죄가 줄어들지 않는 구(crime,cctv사용)->cctv_cor
# 구 이름 통일해주기
for (i in 1:length(cctv$gu)){
cctv$gu[i]<-str_replace_all(cctv$gu[i]," ","")
}
# 구 이름 순서대로 맞춰주기
cctv<-cctv%>%arrange(gu)
crime<-crime%>%arrange(gu)
View(cctv);View(crime)
# cor를 하기 위해 data 형식 바꿔주기
cctv_f<-as.data.frame(t(cctv),stringsAsFactors = F)
crime_f<-as.data.frame(t(crime),stringsAsFactors = F)
gu = cctv$gu
cor_v = c()
for (i in 1:length(gu)){
cor_v[i] <- cor(as.numeric(cctv_f[2:6,i]),as.numeric(crime_f[2:6,i]))
}
cor_v
cctv_cor<-as.data.frame(cbind(gu,cor_v))
cctv_cor<- cctv_cor%>%
arrange(cor_v)
#######################3. 10만명 당 지구대, 경찰서 수가 적은 구(pop,police 사용)->gu_police
gu_police <- left_join(pop,police)%>%
mutate(gu_police=(p_station+p_substation)/(population/100000))%>%
arrange(gu_police)
View(gu_police)
###########################################gu_crime 시각화
???
####################### 어떤 지역 선택??
head(gu_crime)
gu_police
head(cctv_cor)
###########################################gu_crime 시각화
???
####################### 어떤 지역 선택??
head(gu_crime)
gu_crime
class(gu_crime)
gu_crime
write.csv(gu_crime)
write.csv(gu_crime, "C:/Users/student/Desktop/local_reposit/semi_project/data/gu_crime.csv")
gu_mapid
gu_mapid = read.csv(file.choose(), stringsAsFactors = T )
gu_mapid = as.data.frame(gu_mapid)
left_join(gu_mapid,gu_crime, by=gu_crime$gu)
hellp(left_join())
hellp(left_join
hellp(left_join)
help(left_join)
gu_mapid
left_join(gu_mapid,gu_crime, by=null)
left_join(gu_mapid,gu_crime)
rename(gu_mapid,
gu,
시군구명)
help(rename)
gu_mapid <- rename(gu_mapid,
시군구명 = "gu")
gu_mapid <- rename(gu_mapid,
gu = "시군구명")
gu_mapid
left_join(gu_mapid,gu_crime, by=gu)
left_join(gu_mapid,gu_crime, by="gu")
left_join(gu_mapid,gu_crime, by="gu", stringsAsFactors = T)
gu_crime
df <- left_join(gu_mapid,gu_crime, by="gu", stringsAsFactors = T)
class(df)
View(df)
View(gu_crime)
View(df)
crimemap_df <- left_join(gu_mapid,gu_crime, by="gu", stringsAsFactors = T)
class(crimemap_df)
View(crimemap_df)
########################서울시 행정구별 범죄률 지도를 작성해보자
map <- shapefile("C:/R_Lecture/data/SIG_201703/TL_SCCO_SIG.shp") #좌표계 설정
map <- spTransform(map,CRSobj = CRS("+proj=longlat +ellps=WGS84 +datumWGS84 +no_defs"))
korea_map <- fortify(map,region ="SIG_CD")
View(korea_map)
#서울시만 뽑아내기
korea_map$id <- as.numeric(korea_map$id)
seoul_map <- korea_map[korea_map$id <= 11740,]
map_merge <- merge(seoul_map, crimemap_df, by="id")
View(map_merge)
crime_map <- ggplot() + geom_polygon(data = map_merge,
aes(x=long, y = lat, group = group, fill=X2018),
color = "gold")
crime_map
View(map_merge)
crime_map <- ggplot() + geom_polygon(data = map_merge,
aes(x=long, y = lat, group = group, fill=gu_crime),
color = "gold")
crime_map
raw <- "C:/R_Lecture/data/SIG_201905/CCTV11.csv"
df <- read.csv(file = raw,
header = T,
fileEncoding = "UTF-8")
map <- shapefile("C:/R_Lecture/data/SIG_201703/TL_SCCO_SIG.shp") #좌표계 설정
map <- spTransform(map,CRSobj = CRS("+proj=longlat +ellps=WGS84 +datumWGS84 +no_defs"))
korea_map <- fortify(map,region ="SIG_CD")
#서울시만 뽑아내기
korea_map$id <- as.numeric(korea_map$id)
seoul_map <- korea_map[korea_map$id <= 11740,]
map_merge <- merge(seoul_map, df, by="id")
cameras <- ggplot() + geom_polygon(data = map_merge,
aes(x=long, y = lat, group = group, fill=X2018),
color = "gold")
cameras
View(map_merge)
#3. 용산구
#shp 파일에서 용산구만 뽑아내기
yongsan_map <- small_map[(11170100 < small_map$id) & (small_map$id <= 11170136),]
#일단 merge안한 지도부터
ggplot() + geom_polygon(data = yongsan_map,
aes(x=long,
y=lat,
group=group),
color="black")
#1. 종로구
#shp 파일에서 용산구만 뽑아내기(뭐야 개넓어)
jongro_map <- small_map[(11110100 < small_map$id) & (small_map$id <= 11110290),]
#일단 merge안한 지도부터
ggplot() + geom_polygon(data = jongro_map,
aes(x=long,
y=lat,
group=group),
color="black")
#3. 용산구
#shp 파일에서 용산구만 뽑아내기
yongsan_map <- small_map[(11170100 < small_map$id) & (small_map$id <= 11170136),]
#일단 merge안한 지도부터
ggplot() + geom_polygon(data = yongsan_map,
aes(x=long,
y=lat,
group=group),
color="black")
#여성 안전지킴이집 좌표
read.csv(file = "C:/Users/student/Desktop/local_reposit/semi_project/data/서울특별시_용산구_여성안심지킴이집_20190731.csv") -> female_safety
arrange(female_safety,관할경찰서명)-> female_safety
View(female_safety)
female_safety_1 <- female_safety %>%
select("위도","경도","소재지지번주소","관할경찰서명")
View(female_safety_1)
#3. 용산구
#shp 파일에서 용산구만 뽑아내기
yongsan_map <- small_map[(11170100 < small_map$id) & (small_map$id <= 11170136),]
#일단 merge안한 지도부터
ggplot() + geom_polygon(data = yongsan_map,
aes(x=long,
y=lat,
group=group),
color="gold")
# merge한 지도 (여기서부터는 진행중)
yongsan_merge <- ggplot() + geom_polygon(data = yongsan_merge,
aes(x=long,
y=lat,
group = group,
fill =X2018),
color = "black") +
geom_point(data=female_safety_1,aes(x=경도,y=위도),size=1,color="red")
# merge한 지도 (여기서부터는 진행중)
ggplot() + geom_polygon(data = yongsan_map,
aes(x=long,
y=lat,
group=group),
color="gold") +
geom_point(data=female_safety_1,aes(x=경도,y=위도),size=1,color="red")
#안전 비상벨 위치
read.csv(file = "C:/Users/student/Desktop/local_reposit/semi_project/data/서울특별시_용산구_안전비상벨위치_20190725.csv") -> safety_bell
#안전 비상벨 위치
read.csv(file = "C:/Users/student/Desktop/local_reposit/semi_project/data/서울특별시_용산구_안전비상벨위치_20190725.csv") -> safety_bell
View(safety_bell)
View(female_safety)
arrange(safety_bell,소재지지번주소) -> safety_bell
arrange(safety_bell,소재지지번주소) -> safety_bell
safety_bell_1 <- safety_bell %>%
select(위도, 경도)
View(safety_bell_1)
# merge한 지도 (여기서부터는 진행중)
ggplot() + geom_polygon(data = yongsan_map,
aes(x=long,
y=lat,
group=group),
color="gold") +
geom_point(data=female_safety_1,aes(x=경도,y=위도),size=1,color="red")+
geom_point(data=safety_bell_1,aes(x=경도, y=위도), size=1,color="green")
#############################################
####네이버지도 투명도덧씌우기
install(devtools)
#############################################
####네이버지도 투명도덧씌우기
install.packages("devtools")
#############################################
####네이버지도 투명도덧씌우기
library(devtools)
install_github("ggmap", "haven-jeon")
library(ggmap)
library(ggplot2)
library(raster)
library(rgeos)
library(maptools)
library(rgdal)
library(stringr)
library(tidyverse)
library(sf)
library(viridis)
sessionInfo()
install_github("ggmap", "haven-jeon")
install.packages("Rtools")
# 구글 맵 투명도로 덧씌우기
googleAPIkey = "AIzaSyD_kdESG6jCzU3SxGl8FWIxp_MkAYeynRw"
register_google(googleAPIkey)
cen <- c(126.981825,37.529563)
gg_seoul <- get_googlemap(center = cen,
maptype = "roadmap",
zoom = 13)
myMap <- ggmap(gg_seoul) +
geom_point(data=female_safety_1,aes(x=경도,y=위도),size=1,color="red") +
geom_point(data=safety_bell_1,aes(x=경도, y=위도), size=1,color="green") +
geom_polygon(data = yongsan_map,
aes(x=long,
y=lat,
group=group),
color="gold",
col = adjustcolor("gray",alpha = 0.5))
gg_seoul <- get_googlemap(center = cen,
maptype = "roadmap",
zoom = 13)
library(ggmap)
gg_seoul <- get_googlemap(center = cen,
maptype = "roadmap",
zoom = 13)
gg_seoul <- get_googlemap(center = cen,
maptype = "roadmap",
zoom = 13)
# 구글 맵 투명도로 덧씌우기
googleAPIkey = "AIzaSyDb8Oqv9AqTVBFWUKyOZh1SkSv_9SeEtKI"
register_google(googleAPIkey)
cen <- c(126.981825,37.529563)
gg_seoul <- get_googlemap(center = cen,
maptype = "roadmap",
zoom = 13)
myMap <- ggmap(gg_seoul) +
geom_point(data=female_safety_1,aes(x=경도,y=위도),size=1,color="red") +
geom_point(data=safety_bell_1,aes(x=경도, y=위도), size=1,color="green") +
geom_polygon(data = yongsan_map,
aes(x=long,
y=lat,
group=group),
color="gold",
col = adjustcolor("gray",alpha = 0.5))
ggplotly(myMap)
help(geom_polygon)
myMap <- ggmap(gg_seoul) +
geom_point(data=female_safety_1,aes(x=경도,y=위도),size=1,color="red") +
geom_point(data=safety_bell_1,aes(x=경도, y=위도), size=1,color="green") +
geom_polygon(data = yongsan_map,
aes(x=long,
y=lat,
group=group,
colour=phyla,
alpha = 0.8),
color="gold",
col = adjustcolor("gray",alpha = 0.5))
ggplotly(myMap)
myMap <- ggmap(gg_seoul) +
geom_point(data=female_safety_1,aes(x=경도,y=위도),size=1,color="red") +
geom_point(data=safety_bell_1,aes(x=경도, y=위도), size=1,color="green") +
geom_polygon(data = yongsan_map,
aes(x=long,
y=lat,
group=group,
colour=phyla,
alpha = 1.0),
color="gold",
col = adjustcolor("gray",alpha = 0.5))
ggplotly(myMap)
myMap <- ggmap(gg_seoul) +
geom_point(data=female_safety_1,aes(x=경도,y=위도),size=1,color="red") +
geom_point(data=safety_bell_1,aes(x=경도, y=위도), size=1,color="green") +
geom_polygon(data = yongsan_map,
aes(x=long,
y=lat,
group=group,
colour=phyla,
alpha = 0.0),
color="gold",
col = adjustcolor("gray",alpha = 0.5))
ggplotly(myMap)
myMap <- ggmap(gg_seoul) +
geom_point(data=female_safety_1,aes(x=경도,y=위도),size=1,color="red") +
geom_point(data=safety_bell_1,aes(x=경도, y=위도), size=1,color="green") +
geom_polygon(data = yongsan_map,
aes(x=long,
y=lat,
group=group,
colour=phyla,
alpha = 0.0),
color="gold",
col = adjustcolor("gray",alpha = 0.5)
fill=NA)
ggplotly(myMap)
myMap <- ggmap(gg_seoul) +
geom_point(data=female_safety_1,aes(x=경도,y=위도),size=1,color="red") +
geom_point(data=safety_bell_1,aes(x=경도, y=위도), size=1,color="green") +
geom_polygon(data = yongsan_map,
aes(x=long,
y=lat,
group=group,
colour=phyla,
alpha = 0.0),
color="gold",
col = adjustcolor("gray",alpha = 0.5),
fill=NA)
ggplotly(myMap)
ggplotly(myMap)
help(geom_polygon)
myMap <- ggmap(gg_seoul) +
geom_point(data=female_safety_1,aes(x=경도,y=위도),size=1,color="red") +
geom_point(data=safety_bell_1,aes(x=경도, y=위도), size=1,color="green") +
geom_polygon(data = yongsan_map,
aes(x=long,
y=lat,
group=group,
colour=phyla,
alpha = 0.0),
color="black",
col = adjustcolor("gray",alpha = 0.5),
fill=NA)
ggplotly(myMap)
myMap <- ggmap(gg_seoul) +
geom_point(data=female_safety_1,aes(x=경도,y=위도),size=0.1,color="red") +
geom_point(data=safety_bell_1,aes(x=경도, y=위도), size=0.1,color="green") +
geom_polygon(data = yongsan_map,
aes(x=long,
y=lat,
group=group,
colour=phyla,
alpha = 0.0),
color="black",
col = adjustcolor("gray",alpha = 0.5),
fill=NA)
ggplotly(myMap)
help(geom_polygon)
ggplotly(myMap)
myMap <- ggmap(gg_seoul) +
geom_point(data=female_safety_1,aes(x=경도,y=위도),size=0.6,color="red") +
geom_point(data=safety_bell_1,aes(x=경도, y=위도), size=0.6,color="green") +
geom_polygon(data = yongsan_map,
aes(x=long,
y=lat,
group=group,
colour=phyla,
alpha = 0.0),
color="black",
col = adjustcolor("gray",alpha = 0.5),
fill=NA)
ggplotly(myMap)
help(geom_polygon)
ggplotly(myMap)
# 구글 맵 투명도로 덧씌우기
#googleAPIkey = "AIzaSyDb8Oqv9AqTVBFWUKyOZh1SkSv_9SeEtKI"
googleAPIkey = "AIzaSyD_kdESG6jCzU3SxGl8FWIxp_MkAYeynRw"
register_google(googleAPIkey)
cen <- c(126.981825,37.529563)
gg_seoul <- get_googlemap(center = cen,
maptype = "roadmap",
zoom = 13)
myMap <- ggmap(gg_seoul) +
geom_point(data=female_safety_1,aes(x=경도,y=위도),size=0.6,color="red") +
geom_point(data=safety_bell_1,aes(x=경도, y=위도), size=0.6,color="green") +
geom_polygon(data = yongsan_map,
aes(x=long,
y=lat,
group=group,
colour=phyla,
alpha = 0.0),
color="black",
col = adjustcolor("gray",alpha = 0.5),
fill=NA)
# 구글 맵 투명도로 덧씌우기
#googleAPIkey = "AIzaSyD_kdESG6jCzU3SxGl8FWIxp_MkAYeynRw"
googleAPIkey = "AIzaSyDb8Oqv9AqTVBFWUKyOZh1SkSv_9SeEtKI"
register_google(googleAPIkey)
cen <- c(126.981825,37.529563)
gg_seoul <- get_googlemap(center = cen,
maptype = "roadmap",
zoom = 13)
myMap <- ggmap(gg_seoul) +
geom_point(data=female_safety_1,aes(x=경도,y=위도),size=0.6,color="red") +
geom_point(data=safety_bell_1,aes(x=경도, y=위도), size=0.6,color="green") +
geom_polygon(data = yongsan_map,
aes(x=long,
y=lat,
group=group,
colour=phyla,
alpha = 0.0),
color="black",
col = adjustcolor("gray",alpha = 0.5),
fill=NA)
ggplotly(myMap)
# 구글 맵 투명도로 덧씌우기
#googleAPIkey = "AIzaSyD_kdESG6jCzU3SxGl8FWIxp_MkAYeynRw"
googleAPIkey = "AIzaSyDb8Oqv9AqTVBFWUKyOZh1SkSv_9SeEtKI"
register_google(googleAPIkey)
cen <- c(126.981825,37.529563)
gg_seoul <- get_googlemap(center = cen,
maptype = "satellite",
zoom = 13)
myMap <- ggmap(gg_seoul) +
geom_point(data=female_safety_1,aes(x=경도,y=위도),size=0.6,color="red") +
geom_point(data=safety_bell_1,aes(x=경도, y=위도), size=0.6,color="green") +
geom_polygon(data = yongsan_map,
aes(x=long,
y=lat,
group=group,
colour=phyla,
alpha = 0.0),
color="black",
col = adjustcolor("gray",alpha = 0.5),
fill=NA)
ggplotly(myMap)
#CCTV 위치
read.csv(file="C:/Users/student/Desktop/local_reposit/semi_project/data/서울특별시_용산구_CCTV위치.csv") -> yongsan_cctv
View(yongsan_cctv)
# 구글 맵 투명도로 덧씌우기
#googleAPIkey = "AIzaSyD_kdESG6jCzU3SxGl8FWIxp_MkAYeynRw"
googleAPIkey = "AIzaSyDb8Oqv9AqTVBFWUKyOZh1SkSv_9SeEtKI"
register_google(googleAPIkey)
cen <- c(126.981825,37.529563)
gg_seoul <- get_googlemap(center = cen,
maptype = "satellite",
zoom = 13)
myMap <- ggmap(gg_seoul) +
geom_point(data=yongsan_cctv,aes(x=경도, y=위도), size=0.6,color="yellow") +
geom_point(data=female_safety_1,aes(x=경도,y=위도),size=0.6,color="red") +
geom_point(data=safety_bell_1,aes(x=경도, y=위도), size=0.6,color="green") +
geom_polygon(data = yongsan_map,
aes(x=long,
y=lat,
group=group,
colour=phyla,
alpha = 0.0),
color="black",
col = adjustcolor("gray",alpha = 0.5),
fill=NA)
ggplotly(myMap)
